<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Bayan Chat â€” English with AI Bayan 4grade II</title>
<style>
  body {
  <script>
const WORKER_URL = "https://shiny-tree-f78c.aiko030500.workers.dev";

const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

function showMessage(role, text) {
  const msg = document.createElement("div");
  msg.className = "msg " + role;
  msg.textContent = text;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
  const message = userInput.value.trim();
  if (!message) return;

  showMessage("user", "ğŸ§’ " + message);
  userInput.value = "";
  showMessage("ai", "â³ AI Bayan is thinking...");

  try {
    let res = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages: [
          { role: "system", content: "You are AI Bayan, a kind English tutor for Grade 4 students from Kazakhstan." },
          { role: "user", content: message }
        ]
      })
    });

    // Ğ•ÑĞ»Ğ¸ OpenAI Ğ²ĞµÑ€Ğ½ÑƒĞ» 429, Ğ¶Ğ´Ñ‘Ğ¼ 2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ ÑĞ½Ğ¾Ğ²Ğ°
    if (res.status === 429) {
      showMessage("ai", "âš ï¸ Too many requests. Waiting 2 seconds...");
      await new Promise(r => setTimeout(r, 2000));
      res = await fetch(WORKER_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          messages: [
            { role: "system", content: "You are AI Bayan, a kind English tutor for Grade 4 students from Kazakhstan." },
            { role: "user", content: message }
          ]
        })
      });
    }

    const data = await res.json();

    if (!res.ok) {
      showMessage("ai", "âš ï¸ Error: " + (data.error || res.status));
      return;
    }

    showMessage("ai", "ğŸ¤– " + (data.reply || "No response."));

  } catch (err) {
    showMessage("ai", "âŒ Connection failed: " + err.message);
  }
}

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});
</script>

<body>

<header>
  <h1>ğŸ¤– AI Bayan â€” Chat</h1>
  <p>English with <b style="color:gold;">AI Bayan</b> â€” 4grade II</p>
</header>

<main>
  <div id="chatBox">
    <div class="msg ai"><b>AI Bayan:</b> Hello! ğŸŒŸ Iâ€™m your English helper.<br>Ask me about grammar, translation, or homework!</div>
  </div>

  <section id="inputArea">
    <input id="userInput" type="text" placeholder="Type your message..." />
    <button class="btn" onclick="askBayan()">Ask AI Bayan</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="goMenu()">ğŸ  Back to Menu</button>
  </section>
</main>

<script>
async function askBayan() {
  const input = document.getElementById("userInput");
  const message = input.value.trim();
  if (!message) return;

  const chatBox = document.getElementById("chatBox");
  chatBox.innerHTML += `<div class="msg user">${message}</div>`;
  input.value = "";

  chatBox.innerHTML += `<div class="msg ai">â³ AI Bayan is thinking...</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const response = await fetch("https://shiny-tree-f78c.aiko030500.workers.dev", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({
        messages: [
          { role: "system", content: "You are AI Bayan, a friendly English tutor for 4th-grade students. You answer simply and clearly in English." },
          { role: "user", content: message }
        ]
      })
    });

    if (!response.ok) {
      chatBox.lastElementChild.innerHTML = `<b>AI Bayan:</b> âŒ Connection error (${response.status}).`;
      return;
    }

    const data = await response.json();
    const reply = data.reply || "âš ï¸ No reply received from AI Bayan.";
    chatBox.lastElementChild.innerHTML = `<b>AI Bayan:</b> ${reply}`;
    chatBox.scrollTop = chatBox.scrollHeight;

  } catch (err) {
    chatBox.lastElementChild.innerHTML = `<b>AI Bayan:</b> âŒ Network or server error.`;
    console.error(err);
  }
}

function clearChat() {
  document.getElementById("chatBox").innerHTML =
    `<div class="msg ai"><b>AI Bayan:</b> Hello again! ğŸŒŸ Ask me about grammar or translation.</div>`;
}

function goMenu() {
  window.location.href = "index.html";
}
</script>

</body>
</html>
