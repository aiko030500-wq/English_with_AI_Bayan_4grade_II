<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II</title>

<!-- ğŸŒŸ PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#003366">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="AI Bayan 4grade II">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="logo.png">

<style>
  body {
    font-family: Verdana, sans-serif;
    margin: 0;
    text-align: center;
    color: #002b5c;
    background: url('ornament-bg.png') no-repeat center center fixed;
    background-size: cover;
    transition: background 0.6s;
  }
  body.teacher-mode {
    background: linear-gradient(180deg,#fff3b0 0%,#ffe27f 100%);
  }

  header {
    background: rgba(0,51,102,0.85);
    color: white;
    padding: 0.8rem 1rem;
    border-bottom: 5px solid gold;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-direction: column;
  }
  body.teacher-mode header { background: gold; color: #003366; }

  .logo {
    width: 180px; height: 180px;
    border-radius: 50%;
    border: 5px solid gold;
    object-fit: cover;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  h1 {
    margin: 0;
    font-size: 1.3rem;
    color: white;
  }
  p.subtitle {
    margin: 4px 0;
    color: #ffecb3;
    font-size: 0.9rem;
  }

  main { padding: 1rem; }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
    gap: 14px;
    max-width: 900px;
    margin: 20px auto;
  }

  .card {
    background: rgba(255,255,255,0.9);
    border: 2px solid gold;
    border-radius: 16px;
    padding: 14px;
    cursor: pointer;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
    font-weight: bold;
    transition: transform 0.2s;
  }
  .card:hover { transform: scale(1.04); background: #fffbe8; }

  #teacherBanner {
    display: none;
    background: gold;
    color: #003366;
    padding: 10px;
    font-weight: bold;
    border-bottom: 3px solid #003366;
  }
  body.teacher-mode #teacherBanner { display: block; }

  .btn {
    background: #003366;
    color: white;
    border: none;
    border-radius: 10px;
    padding: 10px 16px;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
  }
  .btn:hover { background: gold; color: #003366; }

  .overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.6);
    display: flex; align-items: center; justify-content: center;
    z-index: 999;
  }
  .overlay-card {
    background: white;
    border: 4px solid gold;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
    width: 90%;
    max-width: 380px;
  }
  .overlay-card input {
    width: 100%;
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin: 6px 0;
    font-size: 1rem;
  }
</style>
</head>

<body>

<div id="teacherBanner">ğŸ‘©â€ğŸ« TEACHER MODE ACTIVE â€” unlimited questions</div>

<!-- ğŸ” LOGIN -->
<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h2>English with AI Bayan 4grade II</h2>
    <p style="font-size:0.9rem;">Enter your name and PIN:</p>
    <input type="text" id="nameInput" placeholder="Name">
    <input type="password" id="pinInput" placeholder="PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<header>
  <img src="logo.png" class="logo" alt="AI Bayan">
  <h1>ENGLISH WITH AI BAYAN</h1>
  <p class="subtitle">4 GRADE II</p>
</header>

<main>
  <div id="mainMenu" style="display:none;">
    <div class="grid">
      <div class="card" onclick="openTheme(1)">ğŸ¨ Letâ€™s Have Fun</div>
      <div class="card" onclick="openTheme(2)">ğŸƒ Sports and Exercises</div>
      <div class="card" onclick="openTheme(3)">ğŸµ Arts and Music</div>
      <div class="card" onclick="openTheme(4)">ğŸ‘©â€ğŸ‘§ People and Society</div>
      <div class="card" onclick="openTheme(5)">ğŸ› Shopping</div>
      <div class="card" onclick="openTheme(6)">ğŸ”¬ Science</div>
      <div class="card" onclick="openTheme(7)">ğŸŒ¿ Nature</div>
      <div class="card" onclick="openTheme(8)">ğŸŒ Countries and Cultures</div>
      <div class="card" onclick="openTheme(9)">ğŸ§³ Travel and Tourism</div>
      <div class="card" onclick="openTheme(10)">ğŸ’» Computing</div>
      <div class="card" onclick="openTheme(11)">â¤ï¸ Health</div>
      <div class="card" onclick="openTeacherJournal()">ğŸ« Teacherâ€™s Journal</div>
      <div class="card" onclick="openChat()">ğŸ’¬ AI Bayan Chat</div>
    </div>
  </div>

  <div id="chatSection" style="display:none;">
    <h2>ğŸ’¬ AI Bayan â€” Chat</h2>
    <div id="chatBox"></div>
    <textarea id="chatInput" placeholder="Type your message..."></textarea><br>
    <button class="btn" onclick="askBayan()">Ask</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="backMenu()">ğŸ  Menu</button>
    <p id="limitCounter" style="font-weight:bold;color:#003366;">â­ 3 of 3 questions left today</p>
  </div>
</main>

<script>
const allowedNames=["Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2","Ilyas2","Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2","Kira2","Allahverdy2","Aziza2","Emir2","Monya2","Aeka2","Bayan2","Arai2","Jury2","Jury1","Meyirim2"];
const WORKER_URL="https://shiny-tree-f78c.aiko030500.workers.dev";
let DAILY_LIMIT=3,usedToday=Number(localStorage.getItem("usedToday"))||0,lastDate=localStorage.getItem("lastDate"),today=new Date().toDateString(),isTeacher=localStorage.getItem("isTeacher")==="true";
if(lastDate!==today){usedToday=0;localStorage.setItem("lastDate",today);localStorage.setItem("usedToday",0);}
function updateCounter(){const c=document.getElementById("limitCounter");if(!c)return;c.innerHTML=isTeacher?"ğŸ‘©â€ğŸ« Teacher mode: unlimited questions":`â­ ${3-usedToday} of 3 questions left today`;}
function checkLogin(){const n=document.getElementById("nameInput").value.trim().toLowerCase(),p=document.getElementById("pinInput").value.trim(),a=allowedNames.map(x=>x.toLowerCase());if(a.includes(n)&&p==="6856"){localStorage.setItem("currentStudent",n);localStorage.removeItem("isTeacher");document.getElementById("loginOverlay").style.display="none";document.getElementById("mainMenu").style.display="block";}else if(n==="teacher"&&p==="1402"){localStorage.setItem("isTeacher","true");isTeacher=true;document.body.classList.add("teacher-mode");document.getElementById("loginOverlay").style.display="none";document.getElementById("teacherBanner").style.display="block";document.getElementById("mainMenu").style.display="block";}else alert("âŒ Wrong name or PIN");}
function openTheme(n){window.location.href="theme"+n+".html";}
function openChat(){document.getElementById("mainMenu").style.display="none";document.getElementById("chatSection").style.display="block";updateCounter();}
function openTeacherJournal(){alert("Teacher Journal will open soon!");}
function backMenu(){document.getElementById("chatSection").style.display="none";document.getElementById("mainMenu").style.display="block";}
function bayanSpeak(t){if(!("speechSynthesis"in window))return;const s=()=>{const v=speechSynthesis.getVoices();let voice=v.find(x=>x.name.includes("Google UK English Female")||x.lang==="en-GB");if(!voice)voice=v[0];const u=new SpeechSynthesisUtterance(t);u.voice=voice;u.lang="en-GB";u.rate=0.9;u.pitch=1.1;u.volume=1;speechSynthesis.speak(u);};if(speechSynthesis.getVoices().length===0){speechSynthesis.onvoiceschanged=s;}else s();}
async function askBayan(){const i=document.getElementById("chatInput"),b=document.getElementById("chatBox"),q=i.value.trim();if(!q){alert("Type your question first!");return;}if(!isTeacher&&usedToday>=3){alert("âš ï¸ Limit reached.");return;}b.innerHTML+=`<p><b>You:</b> ${q}</p>`;i.value="";b.innerHTML+=`<p><i>AI Bayan is thinking...</i></p>`;b.scrollTop=b.scrollHeight;try{const r=await fetch(WORKER_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:q}]})});const d=await r.json();const reply=d.reply||"Sorry, I canâ€™t answer now.";b.innerHTML+=`<p><b>AI Bayan:</b> ${reply}</p>`;bayanSpeak(reply);if(!isTeacher){usedToday++;localStorage.setItem("usedToday",usedToday);updateCounter();}}catch{b.innerHTML+=`<p><b>AI Bayan:</b> âŒ Connection error.</p>`;}}
function clearChat(){document.getElementById("chatBox").innerHTML="";}
updateCounter();
</script>

<!-- âœ… PWA -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("sw.js").catch(err => console.log("SW fail:", err));
  });
}
</script>
</body>
</html>
