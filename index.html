<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II (Online)</title>
<style>
  body {
    font-family: Verdana, sans-serif;
    background: linear-gradient(180deg,#fff6e5 0%,#f3e0b8 100%);
    margin: 0;
    color: #002b5c;
    text-align: center;
    transition: background 0.6s;
  }
  body.teacher-mode {
    background: linear-gradient(180deg,#fff3b0 0%,#ffea80 100%);
  }
  header {
    background: #003366;
    color: white;
    padding: 1rem;
    border-bottom: 5px solid gold;
    transition: background 0.6s;
  }
  body.teacher-mode header {
    background: gold;
    color: #003366;
  }
  #teacherBanner {
    display: none;
    background: gold;
    color: #003366;
    font-weight: bold;
    padding: 10px;
    border-bottom: 3px solid #003366;
  }
  body.teacher-mode #teacherBanner { display:block; }

  main { padding: 1rem; }

  .btn {
    display:inline-block;margin:6px;padding:8px 14px;
    border-radius:10px;border:none;
    background:#003366;color:#fff;font-weight:bold;
    cursor:pointer;font-size:0.9rem;transition:0.3s;
  }
  .btn:hover { background:gold;color:#003366; }

  .overlay {
    position:fixed;inset:0;
    background:rgba(0,0,0,0.55);
    display:flex;align-items:center;justify-content:center;
    z-index:999;
  }
  .overlay-card {
    background:white;padding:20px;border-radius:16px;
    width:90%;max-width:400px;
    box-shadow:0 0 15px rgba(0,0,0,0.3);
    border:4px solid gold;text-align:center;
  }
  .overlay-card input {
    width:100%;padding:8px;margin:6px 0;
    border-radius:8px;border:1px solid #ccc;
    font-size:1rem;
  }

  .logo-main {
    width:120px;height:120px;object-fit:cover;
    border-radius:50%;border:3px solid gold;margin-bottom:6px;
  }

  .topics-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    gap:10px;max-width:900px;margin:0 auto 15px;
  }
  .topic-card {
    background:#ffffff;border-radius:16px;padding:12px;
    box-shadow:0 0 8px rgba(0,0,0,0.08);
    cursor:pointer;border:2px solid #dde6ff;font-size:0.95rem;
  }
  .topic-card:hover { border-color:gold;transform:translateY(-1px); }

  #welcomeBox {
    background:linear-gradient(180deg,#fff9ec 0%,#f8e4ba 100%);
    border:3px solid gold;border-radius:20px;
    padding:16px;width:90%;max-width:600px;margin:16px auto 20px;
    box-shadow:0 0 15px rgba(255,215,0,0.4);
  }
  #welcomeBox h2 { margin:4px 0;font-size:1.4rem; }
  #totalStars { font-weight:bold;color:#d48a00; }

  .section { display:none;margin-top:16px; }

  table { font-size:0.85rem;border-collapse:collapse;margin:auto; }
  th,td { padding:4px 6px; }
</style>
</head>
<body>

<div id="teacherBanner">ğŸ‘©â€ğŸ« TEACHER MODE ACTIVE</div>

<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h1>English with AI Bayan</h1>
    <input type="text" id="nameInput" placeholder="Enter your name">
    <input type="password" id="pinInput" placeholder="Enter PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<header>
  <h1>English with AI Bayan 4grade II (ONLINE)</h1>
</header>

<main>
  <div id="welcomeBox" style="display:none;">
    <img src="logo.png" alt="AI Bayan Logo" class="logo-main">
    <h2 id="welcomeText"></h2>
    <p>You have <span id="totalStars">0</span> â­ total stars!</p>
  </div>

  <div id="studentMenu" style="display:none;">
    <div class="topics-grid">
      <div class="topic-card" onclick="openLesson(1)">1. ğŸ¨ Letâ€™s Have Fun!</div>
      <div class="topic-card" onclick="openLesson(2)">2. ğŸƒ Sports and Exercises</div>
      <div class="topic-card" onclick="openLesson(3)">3. ğŸŒ Sports Around the World</div>
      <div class="topic-card" onclick="openLesson(4)">4. ğŸµ Arts and Music</div>
      <div class="topic-card" onclick="openLesson(5)">5. âš½ Popular Team Sports</div>
      <div class="topic-card" onclick="openLesson(6)">6. ğŸ» Museum of Kazakh Musical Instruments</div>
      <div class="topic-card" onclick="openLesson(7)">7. ğŸ“œ Childrenâ€™s Rights & Responsibilities</div>
      <div class="topic-card" onclick="openLesson(8)">8. ğŸ§° Different Jobs</div>
      <div class="topic-card" onclick="openLesson(9)">9. ğŸ‘©â€âš•ï¸ Professions</div>
      <div class="topic-card" onclick="openLesson(10)">10. ğŸ¢ People at Work</div>
      <div class="topic-card" onclick="openLesson(11)">11. ğŸ’¬ What Do You Do?</div>
      <div class="topic-card" onclick="openLesson(12)">12. â¤ï¸ You Can Help!</div>
      <div class="topic-card" onclick="openLesson(13)">13. ğŸ¯ Final Challenge</div>
      <div class="topic-card" onclick="openChatSection()">ğŸ’¬ AI Bayan Chat â€” Ask the Teacher ğŸ¤–</div>
    </div>
    <button class="btn" onclick="openTeacherJournal()">ğŸ« Teacher Journal</button>
  </div>

  <div id="teacherJournal" class="section">
    <h2>ğŸ« Teacher Journal</h2>
    <table border="1">
      <thead>
        <tr>
          <th>Student</th>
          <th>L1</th><th>L2</th><th>L3</th><th>L4</th><th>L5</th><th>L6</th>
          <th>L7</th><th>L8</th><th>L9</th><th>L10</th><th>L11</th><th>L12</th><th>L13</th>
          <th>Chat</th><th>Total â­</th>
        </tr>
      </thead>
      <tbody id="journalBody"></tbody>
    </table>
    <button class="btn" onclick="logout()">Logout</button>
  </div>
</main>

<script>
// âœ… Ğ’ÑĞµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ ÑƒÑ‡ĞµĞ½Ğ¸ĞºĞ¸
const allowedNames = [
  "Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2","Ilyas2",
  "Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2","Kira2","Allahverdy2",
  "Aziza2","Emir2","Monya2","Aeka2","Bayan2","Arai2","Jury2","Jury1","Meyirim2"
];

function checkLogin(){
  const name = document.getElementById("nameInput").value.trim();
  const pin  = document.getElementById("pinInput").value.trim();

  // ğŸ‘©â€ğŸ“ Ğ£Ñ‡ĞµĞ½Ğ¸Ğº
  if(allowedNames.includes(name) && pin === "6856"){
    localStorage.setItem("currentStudent", name);
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("studentMenu").style.display   = "block";
    document.getElementById("welcomeBox").style.display    = "block";
    document.getElementById("welcomeText").innerText = "Hello, " + name + "!";
    updateStars();
  }

  // ğŸ‘©â€ğŸ« Ğ£Ñ‡Ğ¸Ñ‚ĞµĞ»ÑŒ
  else if(name.toLowerCase() === "teacher" && pin === "1402"){
    document.body.classList.add("teacher-mode");
    document.getElementById("loginOverlay").style.display = "none";
    document.getElementById("teacherJournal").style.display = "block";
    document.getElementById("teacherBanner").style.display = "block";
    buildJournal();
  }

  else {
    alert("âŒ Access denied. Check your name or PIN.");
  }
}

function updateStars(){
  const name = localStorage.getItem("currentStudent");
  if(!name) return;
  let total = 0;
  for(let i=1;i<=13;i++){
    total += Number(localStorage.getItem(name+"_lesson"+i+"Stars")) || 0;
  }
  total += Number(localStorage.getItem(name+"_chatStars")) || 0;
  document.getElementById("totalStars").innerText = total;
  localStorage.setItem(name+"_totalStars", total);
}

function buildJournal(){
  const body = document.getElementById("journalBody");
  body.innerHTML = "";
  allowedNames.forEach(name=>{
    let row = "<tr><td>"+name+"</td>";
    let total = 0;
    for(let i=1;i<=13;i++){
      const stars = Number(localStorage.getItem(name+"_lesson"+i+"Stars")) || 0;
      total += stars;
      row += "<td>"+stars+"</td>";
    }
    const chatStars = Number(localStorage.getItem(name+"_chatStars")) || 0;
    total += chatStars;
    row += "<td>"+chatStars+"</td><td>"+total+"</td></tr>";
    body.innerHTML += row;
  });
}

function openLesson(n){ window.location.href = "theme"+n+".html"; }
function openTeacherJournal(){ document.getElementById("studentMenu").style.display = "none"; document.getElementById("teacherJournal").style.display = "block"; buildJournal(); }
function logout(){ window.location.href = "index.html"; }
</script>
  <!-- ğŸ’¬ AI Bayan Online Chat Section -->
<section id="chatSection" class="section" style="display:none; max-width:900px; margin:0 auto;">
  <h2>ğŸ’¬ AI Bayan â€” Online Chat</h2>
  <p>Ask about <b>grammar, vocabulary, translation, or homework</b>.<br>
     You can write in English or Russian.</p>

  <div id="chatBox"
       style="max-height:320px; overflow-y:auto; border:1px solid #ccc;
              padding:10px; border-radius:10px; background:#fff;
              text-align:left; font-size:0.9rem;"></div>

  <textarea id="chatInput"
            placeholder="Type your question here..."
            style="width:100%; border-radius:8px; margin-top:8px; min-height:60px;"></textarea><br>

  <button class="btn" onclick="askBayan()">Ask AI Bayan</button>
  <button class="btn" onclick="clearChat()">Clear</button>
  <button class="btn" onclick="backToMenu()">ğŸ  Back to Menu</button>

  <p id="limitCounter" style="font-weight:bold; color:#003366;">
    â­ 3 of 3 questions left today
  </p>
</section>

<script>
let DAILY_LIMIT = 3;
let usedToday = Number(localStorage.getItem("usedToday")) || 0;
let lastDate = localStorage.getItem("lastDate");
const today = new Date().toDateString();
let isTeacher = localStorage.getItem("isTeacher") === "true";

if (lastDate !== today) {
  usedToday = 0;
  localStorage.setItem("lastDate", today);
  localStorage.setItem("usedToday", 0);
}

function updateCounter() {
  const counter = document.getElementById("limitCounter");
  if (!counter) return;
  if (isTeacher) {
    counter.innerHTML = "ğŸ‘©â€ğŸ« Teacher mode: unlimited questions";
  } else {
    const left = DAILY_LIMIT - usedToday;
    counter.innerHTML = `â­ ${left} of ${DAILY_LIMIT} questions left today`;
  }
}

function openChatSection() {
  document.getElementById("studentMenu").style.display = "none";
  document.getElementById("chatSection").style.display = "block";
  updateCounter();
}

function backToMenu() {
  document.getElementById("chatSection").style.display = "none";
  document.getElementById("studentMenu").style.display = "block";
}

async function askBayan() {
  const input = document.getElementById('chatInput');
  const box = document.getElementById('chatBox');
  const question = input.value.trim();
  if (!question) {
    alert("Type your question first!");
    return;
  }

  if (!isTeacher && usedToday >= DAILY_LIMIT) {
    alert("âš ï¸ You reached todayâ€™s limit of 3 questions.");
    return;
  }

  box.innerHTML += `<p><b>You:</b> ${question}</p>`;
  input.value = "";
  box.innerHTML += `<p><i>AI Bayan is thinking...</i></p>`;
  box.scrollTop = box.scrollHeight;

  try {
    const response = await fetch("https://shiny-tree-f78c.aiko030500.workers.dev", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ messages: [{ role: "user", content: question }] })
    });

    const data = await response.json();
    box.innerHTML += `<p><b>AI Bayan:</b> ${data.reply || "Sorry, I canâ€™t answer now."}</p>`;
    box.scrollTop = box.scrollHeight;

    if (!isTeacher) {
      usedToday++;
      localStorage.setItem("usedToday", usedToday);
      updateCounter();
    }
  } catch (err) {
    box.innerHTML += `<p><b>AI Bayan:</b> âŒ Connection error.</p>`;
  }
}

function clearChat() {
  document.getElementById("chatBox").innerHTML = "";
}
</script>
</body>
</html>
