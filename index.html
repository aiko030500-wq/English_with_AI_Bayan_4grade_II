<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English with AI Bayan 4grade II</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#002D72">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="logo.png">

<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:Verdana,sans-serif;background:#FFF9F2;text-align:center;color:#000;}

/* HEADER */
header{
  background:linear-gradient(180deg,#002D72 0%,#004AAD 100%);
  border-bottom:4px solid #FFD54F;
  box-shadow:0 4px 10px rgba(0,0,0,0.25);
  padding:12px 6px 0;
}
header h1{color:#FFD54F;text-shadow:0 0 12px rgba(255,255,180,0.8);font-size:1.7rem;margin:4px 0 0;}
header h2{color:#FFF8C0;font-weight:bold;font-size:1rem;margin-bottom:6px;}
.ornament{width:100%;height:36px;margin-top:4px;}
.ornament svg path{fill:none;stroke:url(#goldGrad);stroke-width:3;stroke-linecap:round;filter:drop-shadow(0 0 5px rgba(255,255,180,0.9));}

/* LOGIN */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;z-index:999;}
.overlay-card{background:#fff;border:4px solid #CBAE7C;padding:20px;border-radius:16px;box-shadow:0 0 15px rgba(0,0,0,0.35);width:90%;max-width:380px;color:#5B4A33;}
.overlay-card input{width:100%;padding:8px;border-radius:8px;border:1px solid #ccc;margin:6px 0;font-size:1rem;}
.btn{background:#002D72;color:#fff;border:none;border-radius:10px;padding:8px 14px;font-weight:bold;cursor:pointer;margin:6px;font-size:0.9rem;}
.btn:hover{background:#FFD54F;color:#002D72;}

/* MAIN */
main{padding:12px 8px 90px;}
#mainMenu{display:none;}

/* 3-—Ä—è–¥–Ω–æ–µ –º–µ–Ω—é */
.topics-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
  max-width:780px;
  margin:20px auto 15px;
}
.topic-btn{
  border:none;border-radius:14px;
  padding:14px 10px;
  font-size:0.95rem;font-weight:bold;
  color:#333;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  background:#fff;
  transition:0.25s all;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:120px;
}
.topic-btn:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,0.25);}
.topic-btn span.icon{font-size:1.5rem;margin-bottom:4px;}

/* –ü–∞—Å—Ç–µ–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
.t1{background:#E6E0FA;} .t2{background:#FBE4D6;} .t3{background:#D6F5E3;}
.t4{background:#FBE9D9;} .t5{background:#D8F0FA;} .t6{background:#EFE2D2;}
.t7{background:#E2E8FB;} .t8{background:#FCEED6;} .t9{background:#FAD6E1;}
.t10{background:#F9D8E9;} .t11{background:#FAD9D9;} .t12{background:#DCF5DA;} .t13{background:#E6DAFA;}

#extraBtns{margin-top:10px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
.extra-btn{background:#DCC7A1;border:none;border-radius:10px;padding:8px 16px;font-weight:bold;color:#3C2F1E;cursor:pointer;box-shadow:0 3px 6px rgba(0,0,0,0.18);}
.extra-btn:hover{background:#EBDAB5;}

#welcomeBox{margin:16px auto 0;background:#F2E4CC;border:2px solid #C5AF84;border-radius:10px;max-width:680px;padding:10px;color:#3C2F1E;font-weight:bold;}

/* CHAT & JOURNAL */
#chatSection,#teacherJournal{display:none;max-width:900px;margin:12px auto;background:#F3E9CF;border:2px solid #CBAE7C;border-radius:12px;padding:10px;}
#chatBox{background:#fff;border-radius:8px;padding:8px;max-height:260px;overflow-y:auto;text-align:left;color:#000;border:1px solid #ddd;}
textarea{width:95%;border-radius:8px;border:1px solid #ccc;padding:6px;font-family:inherit;min-height:60px;margin-top:6px;}

.install-btn{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);background:#C5AF84;color:#fff;border:none;border-radius:50%;width:50px;height:50px;font-size:0.8rem;box-shadow:0 3px 8px rgba(0,0,0,0.35);cursor:pointer;z-index:50;}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="overlay" id="loginOverlay">
  <div class="overlay-card">
    <h2>English with AI Bayan</h2>
    <p>Enter your name and PIN:</p>
    <input type="text" id="nameInput" placeholder="Name">
    <input type="password" id="pinInput" placeholder="PIN" maxlength="4">
    <button class="btn" onclick="checkLogin()">Enter</button>
  </div>
</div>

<!-- HEADER -->
<header>
  <h1>ENGLISH WITH AI BAYAN</h1>
  <h2>4 GRADE II</h2>
  <div class="ornament">
    <svg viewBox="0 0 800 40" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
      <defs>
        <linearGradient id="goldGrad" x1="0" y1="0" x2="800" y2="0">
          <stop offset="0%" stop-color="#FFD700"/>
          <stop offset="50%" stop-color="#FFF8C0"/>
          <stop offset="100%" stop-color="#FFD700"/>
        </linearGradient>
      </defs>
      <path d="M0 20 q30 -20 60 0 t60 0 q30 -20 60 0 t60 0 q30 -20 60 0 t60 0 q30 -20 60 0 t60 0"/>
    </svg>
  </div>
</header>

<main>
  <div id="mainMenu">
    <div class="topics-grid">
      <button class="topic-btn t1" onclick="openTheme(1)"><span class="icon">üé®</span>1. Let‚Äôs Have Fun!</button>
      <button class="topic-btn t2" onclick="openTheme(2)"><span class="icon">üèÉ</span>2. Sports & Exercises</button>
      <button class="topic-btn t3" onclick="openTheme(3)"><span class="icon">üåç</span>3. Sports Around World</button>
      <button class="topic-btn t4" onclick="openTheme(4)"><span class="icon">üéµ</span>4. Arts & Music</button>
      <button class="topic-btn t5" onclick="openTheme(5)"><span class="icon">‚öΩ</span>5. Team Sports</button>
      <button class="topic-btn t6" onclick="openTheme(6)"><span class="icon">üéª</span>6. Kazakh Instruments</button>
      <button class="topic-btn t7" onclick="openTheme(7)"><span class="icon">üìú</span>7. Children‚Äôs Rights</button>
      <button class="topic-btn t8" onclick="openTheme(8)"><span class="icon">üß∞</span>8. Different Jobs</button>
      <button class="topic-btn t9" onclick="openTheme(9)"><span class="icon">üë©‚Äç‚öïÔ∏è</span>9. Professions</button>
      <button class="topic-btn t10" onclick="openTheme(10)"><span class="icon">üè¢</span>10. People at Work</button>
      <button class="topic-btn t11" onclick="openTheme(11)"><span class="icon">üí¨</span>11. What Do You Do?</button>
      <button class="topic-btn t12" onclick="openTheme(12)"><span class="icon">‚ù§Ô∏è</span>12. You Can Help!</button>
      <button class="topic-btn t13" onclick="openTheme(13)"><span class="icon">üéØ</span>13. Final Challenge</button>
    </div>

    <div id="extraBtns">
      <button class="extra-btn" onclick="openChat()">üí¨ AI Bayan Chat</button>
      <button class="extra-btn" onclick="openTeacherJournal()">üè´ Teacher‚Äôs Journal</button>
    </div>

    <div id="welcomeBox">
      <div id="welcomeText">Hello, Student!</div>
      <div>Total stars: <b><span id="totalStars">0</span> ‚≠ê</b></div>
    </div>
  </div>

  <div id="chatSection">
    <h2>üí¨ AI Bayan ‚Äî Chat</h2>
    <div id="chatBox"></div>
    <textarea id="chatInput" placeholder="Type your question..."></textarea><br>
    <button class="btn" onclick="askBayan()">Ask</button>
    <button class="btn" onclick="clearChat()">Clear</button>
    <button class="btn" onclick="backMenu()">üè† Menu</button>
    <p id="limitCounter">‚≠ê 3 of 3 questions left today</p>
  </div>

  <div id="teacherJournal">
    <h2>üè´ Teacher Journal</h2>
    <table>
      <thead><tr><th>Student</th><th>L1‚ÄìL13</th><th>Chat</th><th>Total ‚≠ê</th></tr></thead>
      <tbody id="journalBody"></tbody>
    </table>
    <button class="btn" onclick="backMenu()">üè† Menu</button>
  </div>
</main>

<button class="install-btn" id="installButton">‚¨áÔ∏è</button>

<script>
const allowedNames=[
  "Aytach2","Aylin2","Alvi2","Zhahangir2","Narmin2","Balman2",
  "Ilyas2","Dmitry2","Irada2","Shyngys2","Kiril2","Sultan2",
  "Kira2","Allahverdy2","Aziza2","Emir2","Monya2","Aeka2",
  "Bayan2","Arai2","Jury2","Jury1","Meyirim2"
];
const WORKER_URL="https://shiny-tree-f78c.aiko030500.workers.dev";
let DAILY_LIMIT=3;
let usedToday=Number(localStorage.getItem("usedToday"))||0;
let lastDate=localStorage.getItem("lastDate");
let today=new Date().toDateString();
let isTeacher=localStorage.getItem("isTeacher")==="true";

if(lastDate!==today){usedToday=0;localStorage.setItem("lastDate",today);localStorage.setItem("usedToday",0);}
function updateCounter(){
  const c=document.getElementById("limitCounter");
  if(!c)return;
  c.innerHTML=isTeacher?"üë©‚Äçüè´ Teacher mode: unlimited questions":`‚≠ê ${DAILY_LIMIT-usedToday} of ${DAILY_LIMIT} questions left today`;
}

/* LOGIN */
function checkLogin(){
  const n=document.getElementById("nameInput").value.trim().toLowerCase();
  const p=document.getElementById("pinInput").value.trim();
  const a=allowedNames.map(x=>x.toLowerCase());
  if(a.includes(n)&&p==="6856"){
    localStorage.setItem("currentStudent",n);
    localStorage.removeItem("isTeacher");isTeacher=false;
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
    const nice=n.charAt(0).toUpperCase()+n.slice(1);
    document.getElementById("welcomeText").innerText="Hello, "+nice+"!";
    calcTotalStars(n);updateCounter();
  }else if(n==="teacher"&&p==="1402"){
    isTeacher=true;localStorage.setItem("isTeacher","true");
    document.getElementById("loginOverlay").style.display="none";
    document.getElementById("mainMenu").style.display="block";
    document.getElementById("welcomeText").innerText="Hello, Teacher!";
    calcTotalStarsForAll();updateCounter();
  }else alert("‚ùå Wrong name or PIN");
}

/* STARS */
function calcTotalStars(studentKey){
  let total=0;
  for(let i=1;i<=13;i++)total+=+localStorage.getItem(studentKey+"_lesson"+i+"Stars")||0;
  total+=+localStorage.getItem(studentKey+"_chatStars")||0;
  document.getElementById("totalStars").innerText=total;
}
function calcTotalStarsForAll(){
  let total=0;
  allowedNames.forEach(n=>{
    for(let i=1;i<=13;i++)total+=+localStorage.getItem(n+"_lesson"+i+"Stars")||0;
    total+=+localStorage.getItem(n+"_chatStars")||0;
  });
  document.getElementById("totalStars").innerText=total;
}

/* NAVIGATION */
function openTheme(n){window.location.href="theme"+n+".html";}
function openChat(){document.getElementById("mainMenu").style.display="none";document.getElementById("chatSection").style.display="block";updateCounter();}
function openTeacherJournal(){document.getElementById("mainMenu").style.display="none";document.getElementById("teacherJournal").style.display="block";buildJournal();}
function backMenu(){document.getElementById("chatSection").style.display="none";document.getElementById("teacherJournal").style.display="none";document.getElementById("mainMenu").style.display="block";}

/* JOURNAL */
function buildJournal(){
  const b=document.getElementById("journalBody");b.innerHTML="";
  allowedNames.forEach(n=>{
    let ls=0;for(let i=1;i<=13;i++)ls+=+localStorage.getItem(n+"_lesson"+i+"Stars")||0;
    const cs=+localStorage.getItem(n+"_chatStars")||0;const t=ls+cs;
    b.innerHTML+=`<tr><td>${n}</td><td>${ls}</td><td>${cs}</td><td>${t}</td></tr>`;
  });
}

/* CHAT */
async function askBayan(){
  const input=document.getElementById("chatInput");
  const box=document.getElementById("chatBox");
  const q=input.value.trim();if(!q){alert("Type your question!");return;}
  if(!isTeacher&&usedToday>=DAILY_LIMIT){alert("‚ö†Ô∏è Daily limit reached.");return;}
  box.innerHTML+=`<p><b>You:</b> ${q}</p><p><i>AI Bayan is thinking...</i></p>`;
  box.scrollTop=box.scrollHeight;input.value="";
  try{
    const r=await fetch(WORKER_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:q}]})});
    const d=await r.json();const reply=d.reply||"Sorry, I can‚Äôt answer now.";
    box.innerHTML+=`<p><b>AI Bayan:</b> ${reply}</p>`;box.scrollTop=box.scrollHeight;
    if(!isTeacher){usedToday++;localStorage.setItem("usedToday",usedToday);updateCounter();}
  }catch(e){box.innerHTML+=`<p><b>AI Bayan:</b> ‚ùå Connection error.</p>`;}
}
function clearChat(){document.getElementById("chatBox").innerHTML="";}
updateCounter();
</script>
</body>
</html>
